{
id: "helicopter_plant",
prototype: ["stationary_vulnerable"],
hitpoints: 50,
zorder: 0,
has_feet: false,
solid_dimensions: ["enemy","common"],
tags: "swallowable",
vars: {
	rotor: null,
	target_y: 0,
	points_value: 15,
},
tmp: {
	anim_repeat: 0,
	spawn_velocity_x: 0,
	spawn_velocity_y: 0,
},
consts: {
	springiness: 160,
	chargeup_repeat: 2,
	frogourmet_tag: "shooting_plant",
},
on_swallowed: "[set(vars.rotor.hitpoints, 0), animation('normal'), set(rotate, 0), set(type, 'shooting_plant')]",
timer_frequency: 5,
on_timer: "if(y < target_y, set(accel_y, 30), set(accel_y, -10))",
on_die: "[proto_event('stationary_vulnerable', 'die'), set(vars.rotor.hitpoints, 0)]",
on_enter_spring_anim: "die()",
on_shoot: "[spawn('shooting_plant.pollen_ball', midpoint_x, midpoint_y, facing,
	            [
	             set(zorder, zorder-1),
				 set(velocity_x, tmp.spawn_velocity_x),
				 set(velocity_y, tmp.spawn_velocity_y),
				]), sound('FlowerShot.ogg')]",
on_process_normal: "set(rotate, min(rotate+3, max(rotate-3, if(level.player.midpoint_x < midpoint_x, 180 - target, target))))
	               where target =
	                  min(90, max(0, (((level.player.midpoint_y - 40) - midpoint_y)*25)/max(2, abs(level.player.midpoint_x - midpoint_x))))",
on_end_normal_anim: "[animation('windup'),
		 set(tmp.spawn_velocity_x, 10*(90-rotate)),
		 set(tmp.spawn_velocity_y, 10*(90 - abs(90-rotate)))
	
	]",
on_end_windup_anim: "[animation('chargeup'), set(tmp.anim_repeat, 0)]",
on_end_chargeup_anim: "if(tmp.anim_repeat >= consts.chargeup_repeat, animation('shoot'), [animation('chargeup'), add(tmp.anim_repeat, 1)])",
on_end_shoot_anim: "animation('normal')",
on_create: "[facing(1), spawn('helicopter_plant.rotor', midpoint_x, y-6, facing), set(accel_y,40), set(target_y, y)]",
on_child_spawned: "if((not vars.rotor), set(vars.rotor, child))",
on_process: "[set(vars.rotor.midpoint_x, midpoint_x), set(vars.rotor.midpoint_y, y-6),
			if(vars.rotor.hitpoints < 1, die())]",
solid_area: [0,2,16,12],
editor_info: {
	category: "enemies, seaside",
},
animation: [
	{
		image: "enemies/helicopter-plant.png",
		pad: 2,
		body_area: "all",
		id: "normal",
		rect: [9,11,24,25],
		frames: 1,
		frames_per_row: 1,
		duration: 50,
	},
	{
		image: "enemies/helicopter-plant.png",
		pad: 3,
		body_area: "all",
		id: "hurt",
		rect: [9,11,24,25],
	},
	{
		image: "enemies/helicopter-plant.png",
		pad: 2,
		body_area: "all",
		id: "spring",
		rect: [9,11,24,25],
		frames: 1,
		frames_per_row: 1,
		duration: 50,
	},
	{
		image: "enemies/helicopter-plant.png",
		pad: 2,
		body_area: "all",
		id: "windup",
		rect: [9,26,24,41],
		frames: 1,
		frames_per_row: 1,
		duration: 6,
	},
	{
		image: "enemies/helicopter-plant.png",
		pad: 0,
		body_area: "all",
		id: "chargeup",
		rect: [9,42,24,58],
		frames: 2,
		frames_per_row: 1,
		duration: 6,
	},
	{
		image: "enemies/helicopter-plant.png",
		pad: 2,
		body_area: "all",
		id: "shoot",
		rect: [9,76,28,88],
		frames: 1,
		frames_per_row: 1,
		duration: 20,
		events: "10:shoot",
	},
],
object_type: {
	id: "rotor",
	prototype: ["hittable"],
	hitpoints: 1,
	properties: {
		team: "'evil'",
	},
	consts: {
		frogourmet_tag: "shooting_plant",
	},
	on_end_normal_anim: "animation('normal')",
	animation: {
		id: "normal",
		image: "enemies/helicopter-plant.png",
		rect: [70,14,93,21],
		frames_per_row: 1,
		frames: 4,
		duration: 4,
		body_area: "all",
	},
},
}
