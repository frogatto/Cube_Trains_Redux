[object_type]
id="waterfall"
no_compile_image="waterfall.png"
on_calculate_segments="[set(x,vars.zone_x1),set(y,vars.zone_y1),set(draw_area, [0, vars.offset, abs(vars.zone_x2-vars.zone_x1)/2, abs(vars.zone_y2-vars.zone_y1)/2])]"
on_create="[set(alpha,120),set_pos_len(y,256),fire_event('calculate_segments'),spawn('waterfall.waterfall_overlay',midpoint_x,midpoint_y,facing),
	
	spawn('sfx_falloff_generator',midpoint_x,midpoint_y,1,[set(effect_name,'ambient/waterfall-heavy.ogg'),set(x_bound,x-50),set(x2_bound,x+50),set(y_bound,y-50),set(y2_bound,y+50),set(max_volume,40),set(master_volume,64)])]"
on_process="[add(vars.offset,-8),fire_event('calculate_segments')]"
on_spawned="fire_event('calculate_segments')"
	[vars]
	length="300"
	max_length="300"
	offset="0"
	start_pos="0"
	[/vars]

	[properties]
	move_pos="def(amount) [set(vars.start_pos, (vars.start_pos+amount)%5), fire_event(me, 'calculate_segments')]"
	set_pos_len="def(pos, len) [set(vars.length, len), set(vars.start_pos, pos%5), fire_event(me, 'calculate_segments')]"
	set_y="def(new_y) if(new_y != y, set(me.y, y + diff))
	   where diff = new_y - y"
	[/properties]

	[animation]
	frame_info="0,0,0,0,976,855,32,64"
	id="normal"
	image="compiled-0.png"
	rect="976,855,1007,918"
	[/animation]

	[object_type]
	id="waterfall_overlay"
	no_compile_image="waterfall.png"
	on_calculate_segments="set(draw_area, [0, vars.offset, 32, vars.length])"
	on_create="[set_pos_len(y,256),fire_event('calculate_segments'),set(alpha,120),add_particles('steam'),add_particles('steam_rising')]"
	on_process="[add(vars.offset,-5),fire_event('calculate_segments')]"
	on_spawned="fire_event('calculate_segments')"
	zorder="2"
		[vars]
		length="300"
		max_length="300"
		offset="0"
		start_pos="0"
		[/vars]

		[properties]
		move_pos="def(amount) [set(vars.start_pos, (vars.start_pos+amount)%5), fire_event(me, 'calculate_segments')]"
		set_pos_len="def(pos, len) [set(vars.length, len), set(vars.start_pos, pos%5), fire_event(me, 'calculate_segments')]"
		set_y="def(new_y) if(new_y != y, set(me.y, y + diff))
		   where diff = new_y - y"
		[/properties]

		[animation]
		h="64"
		id="normal"
		image="effects/waterfall_overlay.png"
		w="32"
		x="0"
		y="0"
		[/animation]

		[particle_system]
		accel_y="80"
		color="100,255,255,255"
		delta_a="2"
		id="steam"
		max_x="54"
		max_y="14"
		min_x="-10"
		min_y="-14"
		spawn_rate="600"
		time_to_live="300"
		type="simple"
		velocity_x="-200"
		velocity_x_random="400"
		velocity_y="00"
		velocity_y_random="800"
			[animation]
			duration="4"
			frames="5"
			h="9"
			id="sparkle"
			image="effects/particles.png"
			pad="3"
			w="9"
			x="3"
			y="67"
			[/animation]

		[/particle_system]

		[particle_system]
		accel_y="-10"
		color="100,255,255,255"
		delta_a="2"
		id="steam_rising"
		max_x="54"
		max_y="494"
		min_x="-10"
		min_y="484"
		spawn_rate="2000"
		time_to_live="300"
		type="simple"
		velocity_x="-400"
		velocity_x_random="800"
		velocity_y="00"
		velocity_y_random="800"
			[animation]
			duration="20"
			frames="5"
			h="9"
			id="sparkle"
			image="effects/particles.png"
			pad="3"
			w="9"
			x="3"
			y="67"
			[/animation]

		[/particle_system]

	[/object_type]

[/object_type]

