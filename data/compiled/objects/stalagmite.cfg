[prototype]
has_feet="no"
id="stalagmite"
object_level_collisions="true"
on_collide="die()"
on_collide_level="die()"
on_collide_object_attack="[
	      if(collide_with.vars.team != vars.team and collide_with_area = 'body' and dies_when_hit, die())]"
on_collide_object_body="if(collide_with.vars.team != vars.team and collide_with_area = 'attack', [get_hit_by(collide_with),die()])"
on_create="[if(vars.zone_x1 > vars.zone_x2, [set(vars.zone_x1, vars.zone_x2), set(vars.zone_x2, vars.zone_x1)]),
            if(vars.zone_y1 > vars.zone_y2, [set(vars.zone_y1, vars.zone_y2), set(vars.zone_y2, vars.zone_y1)])]"
on_die="map([1] * 10, spawn('stalagmite.fragment', midpoint_x, midpoint_y + 1d30 - 1d30, facing))"
on_timer="if(level.player.midpoint_x > vars.zone_x1 and level.player.midpoint_x < vars.zone_x2 and level.player.midpoint_y > vars.zone_y1 and level.player.midpoint_y < vars.zone_y2, set(accel_y, 60))"
solid_dimensions="enemy,player,common"
timer_frequency="2"
	[properties]
	dies_when_hit="1"
	get_hit_by="def(collide_with) if(not (me in collide_with.tmp.already_hit), [
				set(collide_with.tmp, 'already_hit', collide_with.tmp.already_hit + [me]),
				set(me.hitpoints, me.hitpoints - collide_with.vars.damage), if(me.hurt_velocity_y, set(me.velocity_y,me.hurt_velocity_y)), if(me.hurt_velocity_x, set(me.velocity_x,me.hurt_velocity_x * collide_with.facing))])"
	hurt_velocity_x="0"
	hurt_velocity_y="0"
	[/properties]

	[animation]
	attack_area="all"
	duration="50"
	frames="1"
	frames_per_row="1"
	id="normal"
	image="props/stalagmites.png"
	pad="0"
	palettes="cave_brown,cave_deep"
	rect="1,1,16,36"
	[/animation]

	[animation]
	attack_area="all"
	duration="50"
	frames="1"
	frames_per_row="1"
	id="normal"
	image="props/stalagmites.png"
	pad="0"
	palettes="cave_brown,cave_deep"
	rect="22,1,37,36"
	[/animation]

	[animation]
	attack_area="all"
	duration="50"
	frames="1"
	frames_per_row="1"
	id="normal"
	image="props/stalagmites.png"
	pad="0"
	palettes="cave_brown,cave_deep"
	rect="43,1,58,36"
	[/animation]

	[vars]
	damage="1"
	team="'evil'"
	zone_x1="0"
	zone_x2="0"
	zone_y1="0"
	zone_y2="0"
	[/vars]

	[object_type]
	dies_on_inactive="yes"
	id="fragment"
	on_create="[set(velocity_x, 1d500 - 1d500), set(velocity_y, -1d500)]"
	on_end_anim="die()"
		[animation]
		accel_y="60"
		duration="50"
		frames="1"
		frames_per_row="1"
		id="particle"
		image="props/stalagmites.png"
		pad="0"
		palettes="cave_brown,cave_deep"
		rect="2,40,10,48"
		[/animation]

		[animation]
		accel_y="60"
		duration="50"
		frames="1"
		frames_per_row="1"
		id="particle"
		image="props/stalagmites.png"
		pad="0"
		palettes="cave_brown,cave_deep"
		rect="14,40,22,48"
		[/animation]

		[animation]
		accel_y="60"
		duration="50"
		frames="1"
		frames_per_row="1"
		id="particle"
		image="props/stalagmites.png"
		pad="0"
		palettes="cave_brown,cave_deep"
		rect="26,40,34,48"
		[/animation]

		[animation]
		accel_y="60"
		duration="50"
		frames="1"
		frames_per_row="1"
		id="particle"
		image="props/stalagmites.png"
		pad="0"
		palettes="cave_brown,cave_deep"
		rect="2,52,10,60"
		[/animation]

		[animation]
		accel_y="60"
		duration="50"
		frames="1"
		frames_per_row="1"
		id="particle"
		image="props/stalagmites.png"
		pad="0"
		palettes="cave_brown,cave_deep"
		rect="14,52,22,60"
		[/animation]

		[animation]
		accel_y="60"
		duration="50"
		frames="1"
		frames_per_row="1"
		id="particle"
		image="props/stalagmites.png"
		pad="0"
		palettes="cave_brown,cave_deep"
		rect="26,52,34,60"
		[/animation]

	[/object_type]

[/prototype]

