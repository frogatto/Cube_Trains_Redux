
	[object_type]
	id=fish_green
	hitpoints=1
	traction_in_water=1000
	traction_in_air=0
 	friction=1000
 	has_feet=no

	[editor_info]
	category=fish
		[var]
		name=x_bound
		type=x
		value="x - 200"
		[/var]
		[var]
		name=x2_bound
		type=x
		value="x2 + 200"
		[/var]
		[var]
		name=desired_height
		type=y
		value="y"
		[/var]
	[/editor_info]


	[vars]
		team="'evil'"
		points_value="5"
		damage=1
	[/vars]
	
	[properties]
		player_within="def(distance) if((level.player.midpoint_x > midpoint_x - distance) and (level.player.midpoint_x < midpoint_x + distance) and (level.player.midpoint_y > midpoint_y - distance) and (level.player.midpoint_y < midpoint_y + distance), 1, 0)"
		
		ideal_x="def() ((vars.x2_bound + vars.x_bound) / 2)"
		
		inside_aggro_range="def(distance) if(abs(ideal_x() - midpoint_x) < distance, 1, 0)" 
	[/properties]
	
	mass=6

	on_hit_by_player="die()"
	on_die="[score(level,20), spawn_item(me), spawn('die_cloud', midpoint_x, midpoint_y, facing)]"

	timer_frequency=10
	on_timer="if(solid(level, front + facing*90, y, 1, y2 - y),
	            [facing(-facing)])"
	            
	on_end_anim="[set(tmp.already_hit, [])]"

	on_end_swim_anim="if(facing < 0 and x < vars.x_bound or
	                facing > 0 and x2 > vars.x2_bound,
					[facing(-facing), animation('swim')],
					animation('swim'))"
					
					
	#when the fish detects frogatto and isn't too far from his home spot, give chase
	on_process_swimMad="if(cycle%5 = 0, if(player_within(300) and inside_aggro_range(450) and level.player.underwater, [set(accel_y, 30* if(level.player.midpoint_y > midpoint_y,1,-1)), set(facing, if(level.player.midpoint_x > midpoint_x,1,-1))] ,animation('swim') ))"
				
	on_collide="[set(velocity_x, 0), facing(-facing)]"
	on_change_animation_failure="die()"
	on_exit_water="animation('out_of_water')"
	on_enter_water="animation('swim')"
	on_end_out_of_water_anim="die()"

	on_end_startle_anim="animation('swimMad')"
	on_end_swimMad_anim="animation('swimMad')"
	

	on_process_swim="if(cycle%5 = 0, [if(abs(y - vars.desired_height) > 10, set(accel_y, (20*if(vars.desired_height < y, -1, 1))), [set(accel_y,0)]),
		if(player_within(150) and inside_aggro_range(450) ,[animation('startle')])])"

solid_area=3,3,27,19
		[base:animation]
		image=enemies/fish-green.png
		pad=3
		body_area=all
		attack_area=all
		[/animation]

		[animation]
		id=swim
		duplicates=6
		rect=2,1,42,29
		frames=4
		duration=6
		accel_x=20
		[/animation]

		[animation]
		id=swim		#blink variant
		rect=2,33,42,61
		frames=4
		duration=6
		accel_x=20
		[/animation]

		#variation of swimming for when the fish is out of water.
		#if this animation ends without them getting back into water,
		#they will die.
		[animation]
		id=out_of_water
		rect=2,33,42,61
		frames=4
		duration=6
		accel_x=20
		accel_y=80
		[/animation]

		[animation]
		id=startle
		rect=2,65,42,93
		frames=1
		duration=10
		[/animation]

		[animation]
		id=hurt
		rect=90,65,130,93
		frames=1
		duration=10
		[/animation]

		[animation]
		id=swimMad
		rect=2,97,42,125
		frames=4
		duration=6
		accel_x=30
		[/animation]

	[/object_type]
