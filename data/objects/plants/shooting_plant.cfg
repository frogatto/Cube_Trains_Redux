	[object_type]
	id=shooting_plant
	prototype=stationary_vulnerable
	hitpoints=2
	zorder=0
	tags=swallowable

		[consts]
		springiness=160
		thrown_damage=5
		normal_damage=1
		[/consts]

	[editor_info]
	category=plants
	[/editor_info]

	[vars]
		team="'evil'"
		points_value="50"
		damage=1
	[/vars]

	[tmp]
	anim_repeat=0
	[/tmp]

	[consts]
	repeat_thrown=15
	solid_dimensions="['enemy', 'common']"
	[/consts]

	solid_dimensions="enemy,common"

	on_bounced_on="if(animation = 'thrown', die(), %PROTO%)"

	on_enter_thrown_anim="set(vars.damage, consts.thrown_damage)"
	on_leave_thrown_anim="[set(vars.damage, consts.normal_damage), set(brightness, 255)]"

	on_enter_water="die()"

	on_end_thrown_anim="[if(tmp.anim_repeat < consts.repeat_thrown,
	      [add(tmp.anim_repeat, 1), animation('thrown')],
		  [set(tmp.anim_repeat, 0), animation('normal'), set(solid_dimensions_in, consts.solid_dimensions), set(vars.team, 'evil')]),
		  if(tmp.anim_repeat = 4, [set(solid_dimensions_in,consts.solid_dimensions), set(vars.team, 'evil')])
		  ]"
	on_process_thrown="if(tmp.anim_repeat > 13,
	       if(tmp.anim_repeat = 14 and time_in_animation > 7,
				 set(velocity_y, velocity_y-300),
				 if(cycle%6 > 2, set(brightness, 256), set(brightness, 512))))"

	on_collide="if(animation = 'thrown', set(velocity_x, -velocity_x/2))"
	on_collide_feet="if(animation = 'thrown' and velocity_y + abs(velocity_x) > 600,
	   [set(velocity_y, -(velocity_y*3)/5 - (velocity_x*slope_standing_on)/90),
	    set(velocity_x, (velocity_x*4)/5 + (velocity_y*slope_standing_on)/90)])"
	
	on_collide_object_thrown="
	[if(collide_with_area = 'body' and collide_with.vars.team != vars.team and tmp.anim_repeat < 4,
		 [if(collide_with.get_hit_by, [collide_with.get_hit_by(me)]), die()])]"
	
	on_end_normal_anim="if(facing != desired_facing, animation('turn'), animation('shoot')) where desired_facing = if(level.player.x < x, -1, 1)"
	on_end_shoot_anim="animation('normal')"
	on_end_turn_anim="[facing(if(level.player.x < x, -1, 1)), animation('normal')]"
	on_end_spring_anim="animation('normal')"
	
	# save this wml for reference, but I've commented it out because it shouldn't be on this unit
	# on_jumped_on="[animation('spring'),shake_screen(0,200,0,-300)]"

	on_shoot="spawn('pollen_ball', midpoint_x+20*facing, midpoint_y-12, facing, [set_value('velocity_x', 300*facing)])"

	on_change_solid_dimensions_fail="if(tmp.in_change_dimensions_fail or (not collide_with), die(),
	          [set(tmp.in_change_dimensions_fail, 1),
			   fire_event(collide_with, 'blocking_thrown_object'),
			   set(solid_dimensions_in, consts.solid_dimensions),
			   set(tmp.in_change_dimensions_fail, 0)
			  ])"
	on_change_animation_failure="die()"
	on_add_object_fail="[if(collide_with.vars.team != vars.team and collide_with.get_hit_by, collide_with.get_hit_by(me)), die()]"

	solid_area=5,8,18,22

		[base:animation]
		image=enemies/plant-shooting.png
		pad=3
		body_area=all
		accel_y=80
		[/animation]

		[animation]
		id=normal
		duplicates=6
		rect=2,29,28,52
		frames=1
		duration=30
		[/animation]

		[animation]
		id=normal	#blink variant
		rect=93,29,119,52
		frames=1
		duration=30
		[/animation]

		[animation]
		id=shoot
		rect=2,2,28,25
		frames=8
		duration=6
		events="40:shoot"
		[/animation]

		[animation]
		id=turn
		rect=2,56,28,79
		frames=3
		duration=10
		[/animation]

		[animation]
		id=spring
		rect=93,56,119,79
		frames=4
		duration=5
		[/animation]

		[animation]
		id=hurt
		rect=2,83,28,106
		frames=2
		duration=15
		[/animation]
		
		[animation]
		id=thrown
		rect=93,83,119,106
		frames=2
		duration=5
		thrown_area=all
		body_area=none
		[/animation]

	[/object_type]

