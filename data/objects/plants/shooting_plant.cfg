[object_type]
id=shooting_plant
prototype=stationary_vulnerable
hitpoints=2
zorder=0
tags=swallowable

	[consts]
	springiness=160
	thrown_damage=5
	normal_damage=1
	[/consts]

[editor_info]
category=plants
[/editor_info]

[vars]
	team="'evil'"
	points_value="8"
	damage=1
[/vars]

[tmp]
anim_repeat=0
[/tmp]

[consts]
repeat_on_back=8
solid_dimensions="['enemy', 'common']"
[/consts]

solid_dimensions="enemy,common"

on_bounced_on="if(animation in ['thrown', 'on_back'], die(), %PROTO%)"
on_stomped_on="[add(hitpoints, -3), set(green, 0), set(blue, 0),
	                schedule(4, [set(green, 255), set(blue, 255)])]"

on_enter_thrown_anim="set(vars.damage, consts.thrown_damage)"
on_leave_on_back_anim="[set(vars.damage, consts.normal_damage), set(brightness, 255)]"

on_enter_water="die()"

on_swallowed="[set(tmp.anim_repeat, 0), %PROTO%]"

on_end_thrown_anim="if(abs(velocity_x) + abs(velocity_y) > 100,
      set(animation, 'thrown'),
	  [set(vars.team, 'evil'), animation('on_back'), set(tmp.anim_repeat, 0),
	   set(solid_dimensions_in, consts.solid_dimensions)])"

on_end_on_back_anim="if(tmp.anim_repeat < consts.repeat_on_back,
      [add(tmp.anim_repeat, 1), animation('on_back')],
	  [set(tmp.anim_repeat, 0), animation('normal')])"

on_process_on_back="if(tmp.anim_repeat > 6,
       if(tmp.anim_repeat = 7 and time_in_animation > 7,
			 set(velocity_y, velocity_y-300),
			 if(cycle%6 > 2, set(brightness, 256), set(brightness, 512))))"

on_collide_side="if(animation in ['thrown', 'on_back'], set(velocity_x, -velocity_x/2))"
on_collide_feet="[if((animation in ['thrown', 'on_back']),
 if(collide_with and collide_with.get_hit_by and collide_with.vars.team != vars.team and vars.damage > 0, [collide_with.get_hit_by(me), die()],
 if(velocity_y + abs(velocity_x) > 600,
   [set(velocity_y, -(velocity_y*3)/5 - (velocity_x*slope_standing_on)/90),
    set(velocity_x, (velocity_x*4)/5 + (velocity_y*slope_standing_on)/90)])))]"

on_collide_object_thrown="
[if(collide_with_area = 'body' and collide_with.vars.team != vars.team,
	 [if(collide_with.get_hit_by, [collide_with.get_hit_by(me)]), die()])]"

on_collide_object_body="if(animation = 'on_back',
    if(collide_with.vars.team != vars.team and collide_with_area = 'attack', die()), %PROTO%)"

on_end_normal_anim="if(facing != desired_facing, animation('turn'), animation('shoot')) where desired_facing = if(level.player.x < x, -1, 1)"
on_end_shoot_anim="animation('normal')"
on_end_turn_anim="[facing(if(level.player.x < x, -1, 1)), animation('normal')]"
on_end_spring_anim="animation('normal')"

# save this wml for reference, but I've commented it out because it shouldn't be on this unit
# on_jumped_on="[animation('spring'),shake_screen(0,200,0,-300)]"

on_shoot="spawn('pollen_ball', midpoint_x+20*facing, midpoint_y-12, facing, [set(velocity_x, 300*facing)])"

on_change_solid_dimensions_fail="if(tmp.in_change_dimensions_fail or (not collide_with), die(),
          [set(tmp.in_change_dimensions_fail, 1),
		   fire_event(collide_with, 'blocking_thrown_object'),
		   set(solid_dimensions_in, consts.solid_dimensions),
		   set(tmp.in_change_dimensions_fail, 0)
		  ])"
on_change_animation_failure="die()"
on_add_object_fail="[if(collide_with.vars.team != vars.team and collide_with.get_hit_by, collide_with.get_hit_by(me)), die()]"

solid_area=5,8,18,22

	[base:animation]
	image=enemies/plant-shooting.png
	pad=3
	body_area=all
	accel_y=80
	[/animation]

	[animation]
	id=normal
	duplicates=6
	rect=2,29,28,52
	frames=1
	duration=30
	[/animation]

	[animation]
	id=normal	#blink variant
	rect=93,29,119,52
	frames=1
	duration=30
	[/animation]

	[animation]
	id=shoot
	rect=2,2,28,25
	frames=8
	duration=6
	events="40:shoot"
	[/animation]

	[animation]
	id=turn
	rect=2,56,28,79
	frames=3
	duration=10
	[/animation]

	[animation]
	id=spring
	rect=93,56,119,79
	frames=4
	duration=5
	[/animation]

	[animation]
	id=hurt
	rect=2,83,28,106
	frames=2
	duration=15
	[/animation]
	
	[animation]
	id=thrown
	rect=93,83,119,106
	frames=2
	duration=5
	thrown_area=all
	body_area=none
	[/animation]
	
	[animation]
	id=on_back
	rect=93,83,119,106
	frames=2
	duration=5
	thrown_area=none
	body_area=all
	[/animation]

[/object_type]

