[object_type]
	id=bat

	on_become_active="if(vars.bat, if(vars.bat.hitpoints <= 0, die(), fire_event(vars.bat, 'restore')))"
	on_create="[set(alpha, 0), spawn('bat.instance', midpoint_x, midpoint_y, facing)]"

	on_child_spawned="[
	  set(child.vars.zone_x1, vars.zone_x1),
	  set(child.vars.zone_x2, vars.zone_x2),
	  set(child.vars.zone_y1, vars.zone_y1),
	  set(child.vars.zone_y2, vars.zone_y2),
	  set(vars.bat, child)
	 ]"
	
	[vars]
	bat="null()"
	[/vars]

	[editor_info]
	category=bugs
		[var]
		name=zone_x1
		type=x
		value="x-250"
		[/var]
		[var]
		name=zone_x2
		type=x
		value="x+260"
		[/var]
		[var]
		name=zone_y1
		type=y
		value="y-20"
		[/var]
		[var]
		name=zone_y2
		type=y
		value="y+120"
		[/var]
	[/editor_info]

	[animation]
	id="hang"
	image="enemies/bat.png"
	rect="1,1,18,28"
	duration="1000000"
	frames="1"
	[/animation]

[object_type]
id="instance"
prototype="hittable"

traction_in_air=1000
tags=swallowable

on_restore="if(animation = 'thrown', set(hitpoints, 0), [if(vars.flying and (not active), [set(vars.flying, 0), animation('hang'), set(x, vars.start_x), set(y, vars.start_y)])])"

on_create="[set(vars.start_x, x), set(vars.start_y, y)]"
on_end_hang_anim="if(level.player.midpoint_x > vars.zone_x1 and level.player.midpoint_x < vars.zone_x2 and level.player.midpoint_y > vars.zone_y1 and level.player.midpoint_y < vars.zone_y2, [set(animation, 'alert'), set(vars.flying, 1)], set(animation, 'hang'))"
on_end_alert_anim="[set(velocity_y, 200), set(accel_y, -2), animation('fly')]"
on_end_fly_anim="animation('fly')"
on_end_hurt_anim="[set(velocity_y, 200), set(accel_y, -2), animation('fly')]"
on_die="[score(level, 10), spawn_item(self), spawn('die_cloud', midpoint_x, midpoint_y, facing)]"

on_collide_object_thrown="
	[if(collide_with_area = 'body' and collide_with.vars.team != vars.team,
		 [if(collide_with.get_hit_by, [collide_with.get_hit_by(me)]), die()])]"

hitpoints=1
	[vars]
	team="'evil'"
	damage=1
	zone_x1=0
	zone_x2=0
	zone_y1=0
	zone_y2=0
	flying=0
	start_x=0
	start_y=0
	[/vars]

	[base:animation]
	body_area=all
	[/animation]

	[animation]
	id="hang"
	image="enemies/bat.png"
	rect="1,1,18,28"
	duration="10"
	frames="2"
	frames_per_row="2"
	pad="3"
	accel_x=0
	accel_y=0
	velocity_x=0
	velocity_y=0
	[/animation]

	[animation]
	id="alert"
	image="enemies/bat.png"
	rect="43,1,60,28"
	duration="20"
	frames="1"
	frames_per_row="1"
	pad="0"
	[/animation]

	[animation]
	id="fly"
	image="enemies/bat.png"
	rect="1,32,26,70"
	duration="8"
	frames="4"
	frames_per_row="4"
	pad="3"
	reverse="no"
	accel_x=-10
	attack_area=all
	[/animation]

	[animation]
	id="hurt"
	image="enemies/bat.png"
	rect="120,32,145,70"
	duration="10"
	frames="1"
	frames_per_row="1"
	pad="0"
	[/animation]

	[animation]
	id="thrown"
	image="enemies/bat.png"
	rect="120,32,145,70"
	duration="10"
	frames="1"
	frames_per_row="1"
	pad="0"
	accel_y=70
	thrown_area=all
	[/animation]

[/object_type]

[/object_type]
