
	[object_type]
	id=moth_big
	prototype=mosquito
	hitpoints=9
	mass=5

	timer_frequency=90
	[vars]
		centerline=0
	[/vars]

	on_create="[%PROTO%, set(vars.centerline, vars.desired_height)]"

	##TODO:  Fix jitter bug when colliding on its side.  May be as simple as a delay.

	##TODO:  DB0 error when player and moth x or y are the same. :(
	on_timer="spawn('moth_big.shot',midpoint_x,y2+10,facing,
				[set(velocity_x, max(-300,min(300,((1000*(level.player.x-x))/abs(level.player.y-y)) / 2))),
				
				set(velocity_y, max(-300,min(300,((1000*(level.player.y-y))/abs(level.player.x-x)) / 2) ))])"


## This aims our speed to guide us to the desired_height.  We use a sine function to smooth out the motion within our limits.
## Note for this critter that we also vary the desired_height itself, making the bug wander around, vertically.
## remember= wave(-250)=-1000, wave(0)=0, wave(250)=1000, wave(500) = 0, etc
	on_process="[if(solid(level, front + facing*50, y, 1, y2 - y),
	            [facing(-facing), animation('turn')], null()),
	            set(velocity_y, wave( min(250,max(-250, destination_height-midpoint_y ) ) ))
	            
	            ] where destination_height = vars.desired_height + (wave(cycle*5+1000)/15)"

	on_end_anim="[if(facing < 0 and x < vars.x_bound or
	                facing > 0 and x2 > vars.x2_bound,
					[facing(-facing), animation('turn')],
					animation('fly'))]"

		[base:animation]
		image=enemies/moth-big.png
		pad=3
		[/animation]

		[animation]
		id=fly
		rect=1,1,44,44
		frames=4
		duration=5
		[/animation]

		[animation]
		id=turn
		rect=1,1,44,44
		frames=1
		duration=5
		[/animation]

		[animation]
		id=hurt
		rect=1,1,44,44
		frames=1
		duration=18
		[/animation]


		[object_type]
		id=shot
		prototype=shot
		[vars]
			team="'evil'"
			damage=1
		[/vars]
		dies_on_inactive=yes
		affected_by_currents=yes
		object_level_collisions=yes

		on_create="add_particles('particles')"
		on_end_anim="animation('normal')"

		timer_frequency=4
		on_timer="set(rotate, cycle*10)"

			[animation]
			id=normal
			image=enemies/moth-big.png
			rect=191,13,205,27
			pad=3
			frames=2
			duration=2
			reverse=yes
			body_area=all
			attack_area=all
			[/animation]

				[particle_system]
				id=particles
				zorder=9
				type=simple
				spawn_rate=500
				time_to_live=40
				min_x=00
				max_x=20
				min_y=00
				max_y=20
				velocity_magnitude=100
				velocity_magnitude_random=100
				velocity_rotate_random=360
					[animation]
					id=sparkle
					image=enemies/moth-big.png
					x=191
					y=4
					w=7
					h=7
					pad=3
					frames=4
					duration=10
					[/animation]
				[/particle_system]

		[/object_type]
	[/object_type]
