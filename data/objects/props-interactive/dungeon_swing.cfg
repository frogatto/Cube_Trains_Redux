[object_type]
	id=dungeon_swing
	
	[editor_info]
	category=machines
	help="A chain with an object attached to the end of it."
	[var]
		name=by_label
		type=label
		value=''
	[/var]
	[var]
		name=length
		type=y
		value=self.y+200
	[/var]
	[var]
		name=arc
		type=x
		value=self.x+100
	[/var]
	[/editor_info]
	
	[vars]
		by_string='' #set this to load an object with this id#
	[/vars]
	
	on_create = "[
		if(not attached in level.chars, add_object(attached)),
		#transform(range(size(targets)), spawn('ct-cursor-edit.dbg', targets[v][0], targets[v][1], 0)),
		#set(controller.x_schedule, transform(targets, v[0]-attached.img_w/2)),
		set(controller.y_schedule, transform(targets, v[1]-attached.img_h/2)),
		set(controller.schedule_speed, 2),
		debug(arc_size),
		[	set(vars.chain, chain),
			add_object(chain),
		]	where chain = object('rope_angled_controller', self.x, self.y, 0),
		set(vars.attached_obj, attached),
		add_object(controller),
		set(vars.ctrl_obj, controller),
		] where targets = transform(list_single_multiply(range(90), 4),
			[sin(v)*arc_size[0]+midpoint_x, cos(2*v)*(-1*arc_size[1]*0.9#don't know why#)/2+midpoint_y+orbit_length])
		where arc_size = list_subtract(
			orbit(	midpoint_x,
					midpoint_y,
					angle,
					orbit_length),
			orbit(	midpoint_x,
					midpoint_y,
					90,
					orbit_length))
		where orbit_length = length(	midpoint_x,
										midpoint_y,
										vars.arc,
										vars.length)
		where angle = angle_to(self,{'midpoint_x' -> arc, 'midpoint_y' -> length})
		where attached = if(_object, _object, object('dungeon_retracting_bridge.segment'))where _object = if(by_string != '', object(vars.by_string), get_object(level, vars.by_label))
		where controller = object('target', x, y+200, 0)"
	
	on_process = "[
		vars.chain.set_ends(self.midpoint_x, self.midpoint_y, vars.ctrl_obj.x+attached_obj.img_w/2, vars.ctrl_obj.y+attached_obj.img_h/2),
		set(vars.attached_obj.x, vars.ctrl_obj.x), set(vars.attached_obj.y, vars.ctrl_obj.y), 
		]"
	
	[animation]
		id=normal
		image=props/spikedball.png
		rect=25,2,41,18
		collide=0,0,16,16
		duration=10000000
	[/animation]
[/object_type]