	[object_type]
	id=breakable_crate
	prototype=hittable

	[editor_info]
	category=props
		[var]
		name=contents
		type=text
		value="''"
		[/var]
	[/editor_info]

	[vars]
		contents="''"
		team="'neutral'"
	[/vars]

	on_die="[if(vars.contents, spawn(vars.contents, midpoint_x, midpoint_y, facing)),
	         score(level,5),sound('BlockBreak.ogg'),
	         spawn('breakable_crate.particle_system_holder', x,y,facing), remove_object(me)]"

		[properties]
		get_hit_by="def(collide_with) 
			if(me.animation != 'cracked',
			[set(me.animation, 'cracked'), set(vars.time_last_hit, me.cycle)], 
				if (collide_with.consts.damage_cooldown < (cycle - vars.time_last_hit),
				[
				map([0] * 1d2, spawn('breakable_crate_particle', me.x + 1d10, me.y + 1d10, if(1d2=2,1,-1))),
			 	map([0] * 1d3, spawn('breakable_crate_particle2', me.x + 1d10, me.y + 1d10, if(1d2=2,1,-1))),
			execute(me, die())
				]
				))"
				
		[/properties]

	on_collide_object_body=" if(collide_with_area = 'attack', get_hit_by(collide_with))"

	on_collide_side="set(velocity_x, -(velocity_x*70)/100)"
	on_collide_head="set(velocity_y, -velocity_y)"
	on_collide_feet="[set(velocity_x, (velocity_x*70)/100), set(velocity_y, if(abs(velocity_y) > 50, -velocity_y/2, 0))]"
								
	zorder=-1
	solid_area=0,0,15,15

		[base:animation]
		image=props/blocks.png
		accel_y=80
		body_area=all		
		[/animation]

		[animation]
		id=normal
		rect=32,0,47,15
		frames=1
		duration=100
		[/animation]
		[animation]
		id=cracked
		rect=48,0,63,15
		frames=1
		duration=100
		[/animation]

		[object_type]
		id=particle_system_holder
		zorder=100
		hitpoints=300
		dies_on_inactive=true
		timer_frequency=10
		on_create="[set(velocity_x, 0), set(velocity_y, 0), set(animation, 'normal'),
				add_particles('particles'),
				]"
		on_timer="set(hitpoints, hitpoints-10)"
		on_turnOff="[set(particles.generation_rate, 0)]"
		
			[animation]
			accel_y=0
			accel_x=0
			id=normal
			image=effects/particles2.png
			events="2:turnOff"
			duration=10000
			x=0
			y=0
			w=0
			h=0
			[/animation]
			
			[particle_system]
			id=particles
			type=point
			generation_rate_millis=10000
			time_to_live=200
			time_to_live_rand=24
			colors="f9f9dbff,ffc20eff,ffc20eaa,ff7e0088,ae4a2855"
			pos_x=0
			pos_y=0
			pos_x_rand=30
			pos_y_rand=30
			velocity_x=-500
			velocity_x_rand=1000
			velocity_y=-500
			velocity_y_rand=1000
			dot_size=3
			[/particle_system]
		[/object_type]
	[/object_type]
