[object_type]
id=platform2
platform_area=0,26,42,27

	[vars]
	children="[]"
	[/vars]

	[editor_info]
	category=platforms
	help = "A moving platform rigged from ropes."
		[var]
		name=speed
		value=10
		[/var]
		[var]
		name=move_x1
		type=x
		value="x + if(facing < 0, 9, 0)"
		[/var]
		[var]
		name=move_x2
		type=x
		value="x + img_w - if(facing > 0, 9, 0)"
		[/var]
		[var]
		name=move_y1
		type=y
		value="y + img_h - 34"
		[/var]
		[var]
		name=move_y2
		type=y
		value="y + img_h"
		[/var]
		[var]
		name=rope_height
		type=y
		value="y - 128"
		[/var]
		[var]
		name=stopped
		type=boolean
		value="0"
		[/var]
		[var]
		name=dist
		type=int
		value="0"
		[/var]
		[var]
		name=is_zipline
		type=boolean
		value="0"
		[/var]
	[/editor_info]
	
	[properties]
		point1 = "[vars.move_x1, vars.move_y1]"
		point2 = "[vars.move_x2, vars.move_y2]"
		setPos = "def(to) [
			set(self.x, to[0]), 
			set(self.y, to[1]),
			static_rope.set_ends(to[0]+img_w/2-7, to[1]+2, to[0]+img_w/2-7, rope_height),
			]"
		pos = "[self.x, self.y]"
		stop = "map(range(steps+1), 'step', schedule(step, set(vars.stopped, 1-(steps-step)/decimal(steps)))) where steps = 100" #Might want to include an if statement to only do this if it'll decrease speed.
		go   = "map(range(steps+1), 'step', schedule(step, set(vars.stopped,   (steps-step)/decimal(steps)))) where steps = 100"
	[/properties]
	
	on_create = "[
		set(vars.move_x1, move_x1 - if(facing < 0, 9, 0)),
		set(vars.move_x2, move_x2 - img_w + if(facing > 0, 9, 0)),
		set(vars.move_y1, move_y1 - 34),
		set(vars.move_y2, move_y2 - img_h),
		
		[add_object(obj),
		] where obj = object('rope_angled_controller',x,y,0, {'x_1' -> move_x1, 'y_1' -> rope_height, 'x_2' -> move_x2, 'y_2' -> rope_height}),
		
		[add_object(obj),
		set(vars.static_rope, obj)
		] where obj = object('rope_angled_controller'),
		
		if(is_zipline, [set(vars.dist, 78), set(vars.stopped, 1)]),
		]"
		
	on_done_create = "set(vars.speed, 500/distance(point1, point2))"
		
	on_process = "[
		add(vars.dist, vars.speed*(1-vars.stopped)),
		if(vars.zipline_running and vars.dist > 436, [set(vars.zipline_running, 0), set(vars.dist, 78), set(vars.stopped, 1)]),
		setPos(newPos),
		] where newPos = list_add(list_tween(point1, point2, (sin(vars.dist)+1)/2), [0, sqrt(min(distance(pos, point1), distance(pos, point2)))])"
	
	on_jumped_on = "if(vars.is_zipline and (not vars.zipline_running) and vars.stopped, [set(vars.zipline_running, 1), set(vars.stopped, 0)])"
	
	[animation]
		image=props/rope.png
		id=normal
		x=18
		y=0
		w=42
		h=34
	[/animation]
[/object_type]
