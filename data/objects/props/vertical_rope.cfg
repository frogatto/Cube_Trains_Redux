[object_type]
id=vertical_rope

	[vars]
	max_length=300
	length=150
	start_pos=0
	segments="[]"
	[/vars]

	[properties]
	set_pos_len="def(pos, len) [set(vars.length, len), set(vars.start_pos, pos%5), fire_event(me, 'calculate_segments')]"
	move_pos="def(amount) [set(vars.start_pos, (vars.start_pos+amount)%5), fire_event(me, 'calculate_segments')]"
	top="get_object(level, vars.top_segment)"
	bot="get_object(level, vars.bot_segment)"
	set_y="def(new_y) if(new_y != y, [set(y, y + diff),
	                   if(vars.top_segment, set(top.y, top.y + diff)),
	                   if(vars.bot_segment, set(bot.y, bot.y + diff)),
					  ] +
					  map(vars.segments, 'seg', set(get_object(level, seg).y, get_object(level, seg).y + diff)))
	   where diff = new_y - y"
	[/properties]

	on_spawned="fire_event('calculate_segments')"
	on_calculate_segments="set(draw_area, [0, vars.start_pos, 4, vars.length/2])"

	[animation]
	image=props/rope-vertical.png
	id=normal
	x=0
	w=4
	y=0
	h=4
	[/animation]

[/object_type]
