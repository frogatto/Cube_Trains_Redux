[object_type]
id=arcade_acorn_mixer
zorder=5

	[editor_info]
	category=machines
	[/editor_info]
	
	[properties]
	#key = sum of ingredients, 1 being ripe acorn, 10 green acorn, and 100 the blue acorn
	#[a, b] = a is the name of the recipe, b is the score awarded
	recipes="{
		'3' -> ['bottle_acorn_butter_green', 150],
		'12' -> ['bottle_acorn_butter_3', 40],
		'21' -> ['bottle_acorn_butter_4', 50],
		'30' -> ['bottle_acorn_butter_ripe', 240],
		'102' -> ['bottle_acorn_butter_5', 60],
		'111' -> ['bottle_acorn_butter_6', 70],
		'120' -> ['bottle_acorn_butter_7', 80],
		'201' -> ['bottle_acorn_butter_8', 90],
		'210' -> ['bottle_acorn_butter_9', 100],
		'300' -> ['bottle_acorn_butter_10', 360]
		}"
	[/properties]
	
	[vars]
	queue=[]
	[/vars]
	timer_frequency=10
	on_timer="if(size(queue)>2, [
			fire_event('difficulty_up'),
			spawn(recipes[str(mix)][0], midpoint_x+12, y+96, facing) where mix = queue[0] + queue[1] + queue[2],
			add(level.player.score, recipes[str(mix)][1]) where mix = queue[0] + queue[1] + queue[2],
			set(queue, queue[3:])])"
	on_create="set(queue, [])"
	on_collide_object_body="[remove_object(collide_with),
					if(collide_with=level.player, [
						remove_object(collide_with.tmp.tongue_tip),
						remove_object(collide_with.tmp.tongue_shaft),
						spawn('bottle_frogatto', midpoint_x+12, y+96, facing),
						schedule(80, set(level.player.hitpoints, 0))
						],[
						if(collide_with.consts.basic_type = 'acorn_green', add(queue, [1])),
						if(collide_with.consts.basic_type = 'acorn_ripe', add(queue, [10])),
						if(collide_with.consts.basic_type = 'acorn_blue', add(queue, [100]))
						])]"			
	on_difficulty_up="[
				map(dispensers, 'disp', if(disp.vars.dispensing_time > 80, add(disp.vars.dispensing_time, -8)))
					where dispensers = filter(level.chars, 'thing', thing.type='arcade_acorn_dispenser'),
				map(belts, 'belt', [
						add(belt.speed, if(belt.speed > 0, 2, -2)),
						fire_event(belt, 'renew'),
						fire_event(belt, 'setup'), 
						]
					)
					where belts = filter(level.chars, 'thing', thing.type='conveyor_belt')]"
	
		[base:animation]
		body_area=0,0,63,15
		[/animation]

		[animation]
		id=normal
		image=props/nutty-factory-machinery.png
		rect=0,0,63,63
		[/animation]
	[/object_type]
