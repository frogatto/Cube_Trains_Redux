
	[object_type]
	id=breakable_crate
	prototype=hittable
	on_die="[score(level,5),sound('BlockBreak.ogg')]"

		[properties]
		get_hit_by="def(collide_with) if(not (me in collide_with.tmp.already_hit), [
				set(collide_with.tmp.already_hit, collide_with.tmp.already_hit + [me]), 
		
			if(me.animation != 'cracked', set(me.animation, 'cracked'), [map([0,0,0,0,0,0,0,0,0,0], spawn('breakable_crate_particle', me.x + 1d10, me.y + 1d10, me.facing)), execute(me, die())])  ])"
				
		[/properties]

	on_collide_object_body=" if(collide_with_area = 'attack', get_hit_by(collide_with))"

	on_collide="set(velocity_x, -(velocity_x*70)/100)"
	on_collide_head="set(velocity_y, -velocity_y)"
	on_collide_feet="[set(velocity_x, (velocity_x*70)/100), set(velocity_y, -velocity_y/2)]"
				
				on_enter_water="[
				add_wave(midpoint_x, y2, -2000, 5*velocity_y/2, 30*velocity_y, 300, 300),
				add_wave(midpoint_x, y2, 2000, 5*velocity_y/2, 30*velocity_y, 300, 300),
				add_wave(midpoint_x, y2, -1000, 3*velocity_y/2, 20*velocity_y, 200, 200),
				add_wave(midpoint_x, y2, 1000, 3*velocity_y/2, 20*velocity_y, 200, 200),
				add_wave(midpoint_x, y2, -500, 2*velocity_y/2, 10*velocity_y, 100, 100),
				add_wave(midpoint_x, y2, 500, 2*velocity_y/2, 10*velocity_y, 100, 100)
				]"
				
	zorder=-1
	solid_area=0,0,15,15

		[base:animation]
		image=props/blocks.png
		accel_y=80
		body_area=all		
		[/animation]

		[animation]
		id=normal
		rect=32,0,47,15
		frames=1
		duration=100
		[/animation]
		[animation]
		id=cracked
		rect=48,0,63,15
		frames=1
		duration=100
		[/animation]
	[/object_type]
