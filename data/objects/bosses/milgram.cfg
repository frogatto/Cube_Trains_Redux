[object_type]
id="milgram"
prototype=hittable
solid_dimensions=boss
collide_dimension=boss
always_active=yes
zorder=10

	[vars]
		team="'evil'"
		damage=1
		points_value=1000
		passive=1
	[/vars]

	[consts]
		armor=4
		flinch_threshold=24
		springiness=140
	[/consts]

	[editor_info]
	category=milgramen
	[/editor_info]

	[properties]
	choose_action="def() if(1d4 = 1, set(me.animation, 'charge_jump'), if(facing = desired_facing and 1d2 = 1, set(me.animation, 'charge_beam'), set(me.animation, 'walk')))"
	desired_facing="if(level.player.midpoint_x < midpoint_x, -1, 1)"
	[/properties]

	friction=1000
	traction=1000

	hitpoints=24

	on_collide="if(collide_with != level.player, [set(velocity_x, -velocity_x/2), set(facing, -facing)])"
	on_collide_feet="[shake_screen(200, 200, 100, 100), set(velocity_x, 0)]"
	on_end_walk_anim="if(vars.passive, set(animation, 'walk'), choose_action())"
	on_end_stand_anim="if(vars.passive, set(animation, 'stand'), choose_action())"

	on_end_charge_jump_anim="set(animation, 'jump')"
	on_end_jump_anim="set(animation, 'crush')"
	on_end_crush_anim="set(animation, 'stand')"

	on_process_charge_beam="if(time_in_animation = 48, set(animation, 'fire_beam'))"

	on_end_charge_beam_anim="set(animation, 'walk')"
	on_end_fire_beam_anim="[
	   spawn('milgram.energy_shot', midpoint_x + facing*60, midpoint_y + 16, facing, [set(velocity_x, facing*500), set(velocity_y, 20)]),
	   spawn('milgram.energy_shot', midpoint_x + facing*60, midpoint_y + 16, facing, [set(velocity_x, facing*400), set(velocity_y, 100)]),
	   spawn('milgram.energy_shot', midpoint_x + facing*60, midpoint_y + 16, facing, [set(velocity_x, facing*400), set(velocity_y, -100)]),
	   set(animation, 'charge_beam'), set(time_in_animation, 49)]"

	solid_area=17,15,47,65

	[base:animation]
	image="enemies/milgram-spritesheet1.png"
	[/animation]

	[animation]
	id="stand"
	rect="8,7,70,74"
	duration="5"
	frames="5"
	frames_per_row="5"
	pad="3"
	reverse="yes"
	body_area=all
	accel_x=0
	[/animation]

	[animation]
	id="walk"
	accel_x=500
	rect="8,79,70,146"
	duration="4"
	frames="5"
	frames_per_row="5"
	pad="3"
	reverse="yes"
	attack_area=0,30,62,66
	body_area=all
	[/animation]

	[animation]
	id=charge_jump
	rect="4,150,72,226"
	duration=6
	frames=2
	pad=3
	body_area=all
	attack_area=all
	solid_area=17,25,47,75
	[/animation]

	[animation]
	id=jump
	rect="148,150,216,226"
	duration=6
	frames=4
	pad=3
	body_area=all
	attack_area=all
	accel_y=80
	velocity_x=1000
	velocity_y=-2000
	solid_area=17,25,47,75
	[/animation]

	[animation]
	id=crush
	rect="404,232,480,308"
	duration=8
	frames=3
	pad=3
	frames_per_row=1
	accel_y=400
	solid_area=17,25,47,75
	body_area=all
	attack_area=all
	[/animation]

	[animation]
	id="charge_beam"
	accel_x=0
	rect="2,231,98,317"
	duration="6"
	frames="8"
	frames_per_row="4"
	pad="3"
	reverse="yes"
	solid_area=32,34,62,84
	body_area=all
	[/animation]

	[animation]
	id="fire_beam"
	rect="2,422,98,508"
	duration="6"
	frames="1"
	frames_per_row="4"
	pad="3"
	reverse="no"
	solid_area=32,34,62,84
	body_area=all
	[/animation]

	[object_type]
	id=energy_shot
	zorder=50
	dies_on_inactive=yes
	on_end_normal_anim="set(animation, 'normal')"
	always_active=yes

		[vars]
		damage=1
		team="'evil'"
		[/vars]
		[animation]
		attack_area=all
		id=normal
		image=effects/particles2.png
		x=3
		y=15
		w=10
		h=10
		pad=3
		frames=4
		duration=2
		[/animation]
	[/object_type]

	[object_type]
	id=beam

		[vars]
		length=16
		speed=64
		max_length=256
		[/vars]
	zorder=20
	on_process="[set(draw_area, [0, 0, vars.length, 32]),
	             if(vars.length < vars.max_length,
	                [if(facing <= 0, add(x, -2*vars.speed)),
	                 add(vars.length, vars.speed)],
	                add(x, facing*vars.speed))]"
		[animation]
		id=normal
		image=effects/milgram-beam-middle.png
		area=0,0,32,32
		[/animation]
	[/object_type]

[/object_type]

