[object_type]
id="milgram"
prototype=hittable
solid_dimensions=boss
collide_dimension=boss
always_active=yes
zorder=10

	[vars]
		points_value=10000
		passive=1
		charge_counter=0
	[/vars]

	[consts]
		basic_type="'milgram'"
		springiness=140
		charge_duration=30
	[/consts]

	[editor_info]
	category=milgramen
	[/editor_info]

	[properties]
		flinch_threshold=99999999
		armor=40
		team="'evil'"
		attack_damage=2
		choose_action="def() if(1d4 = 1, set(me.animation, 'charge_jump'), if(facing = desired_facing and 1d2 = 1, set(me.animation, if(1d2 = 1, 'charge_missile', 'charge_beam')), set(me.animation, 'walk')))"
		desired_facing="if(level.player.midpoint_x < midpoint_x, -1, 1)"
		handle_knockback="def(collide_with) null()"
	[/properties]

	friction=1000
	traction=1000

	hitpoints=4800  # 400*12

	on_collide_side="if(collide_with != level.player, [set(velocity_x, -velocity_x/2), set(facing, -facing)])"
	on_collide_feet="[set(velocity_x, 0), 
			if(velocity_y > 800, 
					[animation('crush'), shake_screen(200, 200, 100, 100), sound('thump-deep.wav'),
					spawn('milgram.ground_slash',midpoint_x+18*facing,midpoint_y+45,facing, set(velocity_x,800*facing)),
					spawn('milgram.ground_slash',midpoint_x-9*facing,midpoint_y+45,-facing, set(velocity_x,-800*facing)),
					spawn('milgram.ground_slam',midpoint_x+10*facing,midpoint_y-70,facing)],
			animation('stand'))]"

	on_end_walk_anim="if(vars.passive, set(animation, 'walk'), choose_action())"
	on_end_stand_anim="if(vars.passive, set(animation, 'stand'), choose_action())"
	on_end_hurt_anim="animation('stand')"

	on_enter_charge_jump_anim="set(velocity_x,0)"
	on_end_charge_jump_anim="set(animation, 'jump')"
	on_end_jump_anim="set(animation, 'fall')"
	on_enter_crush_anim="[set(velocity_x,0)]"
	on_end_crush_anim="[set(animation, 'stand'),spawn('milgram.decorative_crumble',1040,700,1)]"

	on_process_charge_missile="if(time_in_animation = 30, [set(animation, 'fire_missile'),set(vars.charge_counter,0),fire_event('fire_missile')])"

	on_end_charge_missile_anim="set(animation, 'walk')"

	on_end_fire_missile_anim="if(vars.charge_counter < consts.charge_duration, [animation('fire_missile'), add(vars.charge_counter,1)], [set(animation, 'charge_missile'), set(time_in_animation, 31)])"
	  
	on_fire_missile="[
	   spawn('milgram.guided_missile', midpoint_x + facing*80, midpoint_y - 55, 1),sound('milgram-chargeup.wav')]"

	on_process_charge_beam="if(time_in_animation = 48, set(animation, 'fire_beam'))"

	on_end_charge_beam_anim="set(animation, 'walk')"
	on_end_fire_beam_anim="[
	   spawn('milgram.energy_shot', midpoint_x + facing*60, midpoint_y + 16, facing, [set(velocity_x, facing*500), set(velocity_y, 20)]),
	   spawn('milgram.energy_shot', midpoint_x + facing*60, midpoint_y + 16, facing, [set(velocity_x, facing*400), set(velocity_y, 100)]),
	   spawn('milgram.energy_shot', midpoint_x + facing*60, midpoint_y + 16, facing, [set(velocity_x, facing*400), set(velocity_y, -100)]),
	   set(animation, 'charge_beam'), set(time_in_animation, 49),sound('milgrambreath.wav')]"

	on_end_emote_laugh_anim="animation('stand')"
	on_end_emote_pensive_anim="animation('stand')"
	on_end_emote_talk_anim="animation('stand')"
	on_end_emote_angry_anim="animation('stand')"
	on_end_emote_assertive_anim="animation('stand')"

	solid_area=17,15,47,65

	on_beaten_up_mutter="[set(vars.mutterCounter,3),animation('beaten_up_talk')]"
	on_end_beaten_up_idle_anim="animation('beaten_up_idle')"
	on_end_beaten_up_talk_anim="if(vars.mutterCounter > 0, [add(vars.mutterCounter,-1),animation('beaten_up_talk')] ,animation('beaten_up_idle'))"
	
	on_get_up="[animation('get_up'),set(time_in_animation,121)]"
	on_end_get_up_anim="animation('stand')"
	
	[base:animation]
	image="enemies/milgram-spritesheet1.png"
	[/animation]

	[animation]
	id="stand"
	rect="8,7,70,74"
	duration="5"
	frames="5"
	frames_per_row="5"
	pad="3"
	reverse="yes"
	body_area=all
	accel_x=0
	[/animation]

	[animation]
	id="hurt"
	rect="8,7,70,74"
	duration="5"
	frames="5"
	frames_per_row="5"
	pad="3"
	reverse="yes"
	body_area=all
	accel_x=0
	[/animation]

	[animation]
	id="walk"
	accel_x=500
	rect="8,79,70,146"
	duration="4"
	frames="5"
	frames_per_row="5"
	pad="3"
	reverse="yes"
	attack_area=0,30,62,66
	body_area=all
	[/animation]

	[animation]
	id=charge_jump
	rect="4,150,72,226"
	duration=6
	frames=2
	pad=3
	body_area=all
	attack_area=all
	solid_area=17,25,47,75
	[/animation]

	[animation]
	id=jump
	rect="148,150,216,226"
	duration=6
	frames=4
	pad=3
	body_area=all
	attack_area=all
	accel_y=80
	#velocity_x=1000
	velocity_y=-2000
	solid_area=17,25,47,75
	[/animation]

	[animation]
	id=fall
	rect="427,45,495,121"
	duration=8
	frames=1
	pad=3
	accel_y=400
	solid_area=17,25,47,75
	body_area=all
	attack_area=all
	[/animation]

	[animation]
	id=crush
	accel_x=0
	rect="404,232,480,308"
	duration=8
	frames=2
	pad=3
	reverse=yes
	frames_per_row=1
	accel_y=80
	solid_area=17,25,47,75
	body_area=all
	attack_area=all
	[/animation]

	[animation]
	id="charge_beam"
	accel_x=0
	rect="2,231,98,317"
	duration="6"
	frames="8"
	frames_per_row="4"
	pad="3"
	reverse="yes"
	solid_area=32,34,62,84
	body_area=all
	[/animation]

	[animation]
	id="fire_beam"
	rect="2,422,98,508"
	duration="6"
	frames="1"
	frames_per_row="4"
	pad="3"
	reverse="no"
	solid_area=32,34,62,84
	body_area=all
	[/animation]

	[animation]
	id="charge_missile"
	accel_x=0
	rect="102,419,179,486"
	duration="10"
	frames="3"
	pad="3"
	reverse="yes"
	solid_area=17,15,47,65
	body_area=all
	[/animation]

	[animation]
	id="fire_missile"
	rect="340,3,417,70"
	duration="2"
	frames="2"
	frames_per_row="1"
	pad="3"
	reverse="no"
	solid_area=17,15,47,65
	body_area=all
	[/animation]


	[animation]
	image="enemies/milgram-spritesheet2.png"
	id="emote_talk"
	rect="424,2,486,69"
	duration="6"
	frames="7"
	frames_per_row="1"
	pad="3"
	reverse="yes"
	body_area=all
	accel_x=0
	[/animation]

	[animation]
	image="enemies/milgram-spritesheet2.png"
	id="emote_laugh"
	rect="1,1,73,78"
	duration="8"
	frames="9"
	frames_per_row="3"
	pad="3"
	reverse="yes"
	body_area=all
	accel_x=0
	solid_area=22,25,52,75
	[/animation]

	[animation]
	image="enemies/milgram-spritesheet3.png"
	id="emote_pensive"
	rect="2,165,74,242"
	duration="8"
	frames="15"
	frames_per_row="5"
	pad="3"
	body_area=all
	accel_x=0
	solid_area=22,25,52,75
	[/animation]

	[animation]
	image="enemies/milgram-spritesheet2.png"
	id="emote_assertive"
	rect="2,255,74,332"
	duration="8"
	frames="15"
	frames_per_row="5"
	pad="3"
	body_area=all
	accel_x=0
	solid_area=22,25,52,75
	[/animation]

	[animation]
	image="enemies/milgram-spritesheet3.png"
	id="emote_angry"
	rect="2,1,82,78"
	duration="8"
	frames="12"
	frames_per_row="6"
	pad="3"
	body_area=all
	accel_x=0
	solid_area=15,25,45,75
	[/animation]

	[animation]
	image="enemies/milgram-spritesheet2.png"
	id="beaten_up_idle"
	rect="230,1,314,56"
	duration="30"
	frames="1"
	pad="3"
	body_area=all
	accel_x=0
	solid_area=17,5,47,55
	[/animation]

	[animation]
	id="get_up"
	accel_x=0
	rect="2,231,98,317"
	duration="12"
	frames="8"
	frames_per_row="4"
	pad="3"
	reverse="yes"
	solid_area=32,34,62,84
	body_area=all
	[/animation]

	[animation]
	image="enemies/milgram-spritesheet2.png"
	id="beaten_up_talk"
	rect="230,1,314,56"
	duration="8"
	frames="2"
	pad="3"
	body_area=all
	accel_x=0
	solid_area=17,5,47,55
	[/animation]

	[object_type]
	id=ground_slash
	zorder=50
	dies_on_inactive=yes
	on_end_normal_anim="animation('fadeout')"
	on_end_fadeout_anim="die()"
	always_active=yes
	object_level_collisions="false"
	prototype=shot
	#on_die="spawn('milgram.energy_shot_splash',midpoint_x,midpoint_y,facing)"
	on_create="add_particles('particles')"

		[properties]
		damage=2
		[/properties]

		
		[base:animation]
		image=effects/milgramshots.png
		pad=3
		[/animation]
		
		[animation]
		id=normal
		attack_area=all
		rect=1,164,46,196
		frames=3
		duration=3
		[/animation]
		
		[animation]
		id=fadeout
		rect=1,200,46,232
		frames=3
		duration=2
		[/animation]

		[particle_system]
		id=particles
		type=point
		generation_rate_millis=500
		time_to_live=12
		time_to_live_rand=24
		colors="fff3d7ff,eec6ffff,eec6ffff,ff85fbff,b0009a55"
		pos_x=20
		pos_y=20
		pos_x_rand=32
		pos_y_rand=32
		velocity_x=-1500
		velocity_x_rand=3000
		velocity_y=-200
		velocity_y_rand=400
		[/particle_system]
	[/object_type]

	[object_type]
	id=ground_slam
	zorder=55
	dies_on_inactive=yes
	on_end_normal_anim="die()"
	always_active=yes
	object_level_collisions="false"
	prototype=shot

		[properties]
		damage=2
		[/properties]

		
		[base:animation]
		image=effects/milgramshots2.png
		pad=3
		[/animation]
		
		[animation]
		id=normal
		attack_area=all
		rect=1,1,121,158
		frames=6
		frames_per_row=3
		duration=2
		[/animation]
		
	[/object_type]


	[object_type]
	id=guided_missile
	zorder=50
	traction_in_air=1000
	friction=1000
	on_end_normal_anim="set(animation, 'normal')"
	always_active=yes
	object_level_collisions="false"
	prototype=shot
	on_die="[spawn('milgram.energy_shot_splash',midpoint_x,midpoint_y,facing),sound('milgramfire-Hit.wav')]"
	on_create="[set(rotation_schedule, consts.rotation_schedule_base), add_particles('particles'), fire_event('timer'),schedule(100,set(vars.is_hostile,1))]"

	timer_frequency=25
	on_timer="[if(vars.is_hostile,
	 [set(accel_x, vars.speed*if(midpoint_x < level.player.midpoint_x, 1, -1)),
	 set(accel_y, vars.speed*if(midpoint_y < level.player.midpoint_y, 1, -1)),
	 add(vars.time_to_live, -1), if(vars.time_to_live <= 0, die()),
	 	if(cycle%100 > 60,sound('milgram-homingshot-buzz.wav')) ])]"

		[properties]
		damage=2		
		[/properties]

		[vars]
		is_hostile=0
		time_to_live=60
		speed=6
		[/vars]
		[consts]
			rotation_schedule_base="map(range(18), 'c', c*20)"
		[/consts]
		
		[base:animation]
		attack_area=all
		image=effects/milgramshots.png
		w=19
		h=19
		pad=3
		frames=1
		duration=100
		[/animation]
		
		[animation]
		id=normal
		x=121
		y=1
		[/animation]

		[particle_system]
		id=particles
		type=point
		generation_rate_millis=500
		time_to_live=12
		time_to_live_rand=24
		colors="fff3d7ff,eec6ffff,eec6ffff,ff85fbff,b0009a55"
		pos_x=0
		pos_y=0
		pos_x_rand=20
		pos_y_rand=20
		velocity_x=-1500
		velocity_x_rand=3000
		velocity_y=-1500
		velocity_y_rand=3000
		[/particle_system]
	[/object_type]


	[object_type]
	id=energy_shot
	zorder=50
	dies_on_inactive=yes
	on_end_normal_anim="set(animation, 'normal')"
	always_active=yes
	object_level_collisions="false"
	prototype=shot
	on_die="[spawn('milgram.energy_shot_splash',midpoint_x,midpoint_y,facing),sound('milgramfire-Hit.wav')]"
	on_create="add_particles('particles')"

		[properties]
			damage=2
			team="'evil'"
		[/properties]

		
		[base:animation]
		attack_area=all
		image=effects/milgramshots.png
		w=37
		h=37
		pad=3
		frames=3
		duration=2
		[/animation]
		
		[animation]
		id=normal
		x=1
		y=1
		[/animation]
		
		[animation]
		id=normal
		x=1
		y=41
		[/animation]
		
		[particle_system]
		id=particles
		type=point
		generation_rate_millis=500
		time_to_live=12
		time_to_live_rand=24
		colors="fff3d7ff,eec6ffff,eec6ffff,ff85fbff,b0009a55"
		pos_x=20
		pos_y=20
		pos_x_rand=32
		pos_y_rand=32
		velocity_x=-1500
		velocity_x_rand=3000
		velocity_y=-200
		velocity_y_rand=400
		[/particle_system]
	[/object_type]

	
	[object_type]
	id=decorative_crumble
	zorder=50
	on_end_normal_anim="[set(crumbles.generation_rate, 0),animation('normal2')]"
	on_end_normal2_anim="die()"
	always_active=yes
	
	on_create="[add_particles('crumbles'), schedule(150,die())]"



		[base:animation]
		image=effects/milgramshots.png
		rect=0,0,1,1
		frames=1
		[/animation]

		[animation]
		id=normal
		duration=20
		[/animation]

		[animation]
		id=normal2
		duration=200
		[/animation]

		[particle_system]
		id=crumbles
		type=point
		generation_rate_millis=500
		time_to_live=36
		time_to_live_rand=24
		colors="ddddddff,ffffffff"
		pos_x=-800
		pos_y=0
		pos_x_rand=1600
		pos_y_rand=0
		velocity_x=0
		velocity_x_rand=0
		velocity_y=1500
		velocity_y_rand=3500
		accel_y=100
		
		dot_size=3
		[/particle_system]
	[/object_type]
	
	[object_type]
	id=energy_shot_splash
	zorder=50
	dies_on_inactive=yes
	on_end_normal_anim="die()"
	always_active=yes
		
		[base:animation]
		image=effects/milgramshots.png
		w=37
		h=37
		pad=3
		frames=6
		frames_per_row=3
		duration=4
		[/animation]
		
		[animation]
		id=normal
		x=1
		y=82
		[/animation]
	[/object_type]

	[object_type]
	id=beam

		[vars]
		length=16
		speed=64
		max_length=256
		[/vars]
	zorder=20
	on_process="[set(draw_area, [0, 0, vars.length, 32]),
	             if(vars.length < vars.max_length,
	                [if(facing <= 0, add(x, -2*vars.speed)),
	                 add(vars.length, vars.speed)],
	                add(x, facing*vars.speed))]"
		[animation]
		id=normal
		image=effects/milgram-beam-middle.png
		area=0,0,32,32
		[/animation]
	[/object_type]

[/object_type]

