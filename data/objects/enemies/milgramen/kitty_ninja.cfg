	
	[object_type]
	id=kitty_ninja
	prototype=kitty
	#solid_area=6,10,26,33
	solid_area=24,10,47,33
	
	[editor_info]
	category=milgramen
	[/editor_info]

	[vars]
		points_value=271
		turns_at_cliffs=1
		turns_towards_player=0
		posthurt_counter=0
		escape_counter=0
	[/vars]
	
	[consts]
		basic_type="'kitty_spear'"
	[/consts]

	[properties]
		player_in_attack_area="if(abs(level.player.midpoint_y - midpoint_y) < 100 and abs(level.player.midpoint_x - midpoint_x) > 150 and abs(level.player.midpoint_x - midpoint_x) < 350, 1, 0)"



		player_facing_us="if(level.player.facing - player_side = 0, 0,1 ) where player_side = if(level.player.midpoint_x > midpoint_x, 1, -1)"

		player_too_close="if(abs(level.player.midpoint_x - midpoint_x) < 150, 1, 0)"
		
		begin_attack="def() animation('dash')"

		jump_back="def() [add(velocity_y, -1000), add(velocity_x, -1000*facing), animation('jumpback')]"

		escape_to_start="def() [debug('escape!'),animation('hide'), set(x, vars.init_x), set(y, vars.init_y)]"

		consider_escape="def() if(vars.escape_counter < 50,[add(vars.escape_counter, 1), if(not animation in ['stand'],animation('stand'))], animation('smokebomb'))"

		choose_action="def() if(facing !=desired_facing, [animation('turn'), set(facing, desired_facing)], 
								if(player_too_close, jump_back(),
									if(player_in_attack_area, begin_attack(), consider_escape() )))"
									
	[/properties]
	
	on_create="[animation('hide'),set(vars.init_x, x), set(vars.init_y, y)]"
	on_end_dash_anim="if(abs(level.player.midpoint_x - self.midpoint_x) < 120 or facing != desired_facing, [animation('slash')], animation('dash'))"
	
	on_end_slash_anim="animation('recovery')"
	on_end_turn_anim="animation('stand')"
	on_end_stand_anim="choose_action()"
	on_end_recovery_anim="choose_action()"

	on_end_jumpback_anim="if(is_standing, animation('stand'), animation('jumpback'))"


	on_end_smokebomb_anim="[spawn('kitty_ninja.smoke_spawner',midpoint_x, midpoint_y, facing),escape_to_start()]"
	#on_become_active="escape_to_start()"

	on_process_hide="[set(facing, desired_facing),if(player_in_attack_area and (not player_facing_us), begin_attack())]"
	on_end_hide_anim="animation('hide')"

	
		[base:animation]
		image=enemies/kitty-spear.png
		accel_x=0
		accel_y=80
		pad=3
		rotate_on_slope=yes
		body_area=all
		[/animation]

		[animation]
		id=hide
		image=enemies/kitty-ninja.png
		rect=1,432,64,470
		frames=4
		duration=5
		reverse=yes
		accel_y=0
		velocity_y=0
		solid_area=none
		[/animation]

		[animation]
		id=hide
		image=enemies/kitty-ninja.png
		rect=68,390,131,428
		frames=1
		duplicates=6
		duration=20
		accel_y=0
		velocity_y=0
		solid_area=none
		[/animation]

		[animation]
		id=dash
		image=enemies/kitty-ninja.png
		rect=135,11,238,51
		frames=1
		duration=8
		accel_x=2000
		solid_area=48,10,68,33
		[/animation]

		[animation]
		id=slash
		image=enemies/kitty-ninja.png
		rect=135,53,238,93
		frames=5
		pad=1
		frames_per_row=1
		duration=3
		solid_area=48,10,68,33
		[/animation]

		[animation]
		id=jumpback
		image=enemies/kitty-ninja.png
		rect=68,1,131,39
		frames=1
		duration=8
		[/animation]

		[animation]
		id=smokebomb
		image=enemies/kitty-ninja.png
		rect=252,5,317,54
		solid_area=24,24,47,47
		frames=7
		frames_per_row=1
		duration=5
		pad=1
		[/animation]
	
		[animation]
		id=stand
		image=enemies/kitty-ninja.png
		rect=1,1,64,39
		frames=3
		frames_per_row=1
		duration=5
		reverse=yes
		[/animation]
		
		[animation]
		id=recovery
		image=enemies/kitty-ninja.png
		rect=68,306,131,344
		frames=1
		duration=15
		[/animation]

		[animation]
		id=turn
		image=enemies/kitty-ninja.png
		rect=1,306,64,344
		frames=3
		frames_per_row=1
		duration=2
		[/animation]

		[animation]
		id=walk
		accel_x=300
		rect=1,79,41,114
		frames=4
		duration=6
		[/animation]



		[animation]
		id=spring
		rect=1,40,41,75
		frames=5
		duration=4
		[/animation]

		[animation]
		id=hurt
		rect=1,157,41,192
		frames=1
		duration=12
		events="4:8:12:hurtflicker"
		[/animation]

		[animation]
		id=posthurt		#looks around angrily to see who hit him.  Repeat 3x.
		rect=133,157,173,192
		frames=2
		duration=4
		[/animation]

		[animation]
		id=alert		#"Hey, I see the player!"  hops with an ! over head and gets mad.
		rect=1,197,41,232
		frames=6
		duration=6
		[/animation]

		[object_type]
		id=smoke_spawner
		[properties]
			smoke_spawn="def() spawn('kitty_ninja.smoke_cloud', midpoint_x + 1d50-25,  midpoint_y + 1d50-25, facing)"
		[/properties]
		on_create="[	map([0]*3, smoke_spawn() ),
						schedule(2, smoke_spawn() ),
						schedule(4, smoke_spawn() ),
						schedule(6, die())
					] "
			[animation]
			id=die
			image=effects/die-cloud.png
			rect=4,57,1,1
			duration=3
			[/animation]
		
		[/object_type]
	
		[object_type]
		id=smoke_cloud
		hitpoints=1
		on_end_anim="die()"
#		on_create="sound('splat.ogg')"
		on_process="if(cycle%6=0,spawn('die_cloud_2',midpoint_x+1d10-5,midpoint_y+1d30-15,facing))"
		zorder=40
			[animation]
			id=die
			image=effects/die-cloud.png
			rect=4,57,48,101
			frames=15
			frames_per_row=5
			pad=3
			duration=3
			[/animation]
		[/object_type]



	[/object_type]

