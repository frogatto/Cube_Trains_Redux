
	[object_type]
	id=moth_small
	prototype=ant_flying
	hitpoints=5
	mass=5


	timer_frequency=90
	activation_border=500
	[consts]
		basic_type="'moth_small'"
		thrown_type="'moth_small.thrown'"
		basic_animation="'fly'"
	[/consts]

	on_timer="spawn('moth_small.warning', midpoint_x+5*facing, midpoint_y - 10, facing, set(parent, me))"

	on_fire="spawn('moth_small.shot',midpoint_x+5*facing, midpoint_y - 10,facing,
				[set(velocity_x, max(-300,min(300,((1000*(level.player.x-x))/abs(level.player.y-y)) / 2))),
				
				set(velocity_y, max(-300,min(300,((1000*(level.player.y-y))/abs(level.player.x-x)) / 2) ))])"

	on_bounced_on="animation('spring')"
	

## This aims our speed to guide us to the desired_height.  We use a sine function to smooth out the motion within our limits.
## Note for this critter that we also vary the desired_height itself, making the bug wander around, vertically.
## remember= wave(-250)=-1000, wave(0)=0, wave(250)=1000, wave(500) = 0, etc

	on_process_fly="%PROTO% + (wave(cycle*5+1000)/15)"

		[base:animation]
		image=enemies/moth-small.png
		pad=3
		body_area=all
		attack_area=none
		[/animation]

		[animation]
		id=fly
		rect=3,2,35,32
		frames=4
		duration=5
		reverse=yes
		[/animation]

		[animation]
		id=turn
		rect=3,39,35,69
		frames=2
		frames_per_row=1
		duration=4
		accel_y=0
		[/animation]

		[animation]
		id=hurt
		rect=39,73,71,103
		frames=1
		duration=18
		events="6:12:18:hurtflicker"
		[/animation]

		[animation]
		id=spring
		rect=75,73,107,103
		frames=1
		duration=4
		[/animation]



		[object_type]	
		id=thrown
		prototype=throwable_small_enemy
		solid_dimensions=common,enemy

		[consts]
			basic_type="'moth_small'"
			thrown_type="'moth_small.thrown'"
			basic_animation="'fly'"
		[/consts]

			[base:animation]
			image=enemies/moth-small.png
			[/animation]

			[animation]
			id=thrown
			thrown_area=all
			duration=60
			rect=39,39,71,69
			frames=1
			body_area=none
			[/animation]
	
			[animation]
			id=on_back
			rect=39,39,71,69
			frames=2
			duration=5
			body_area=all
			[/animation]
		[/object_type]
	

		[object_type]
		id=warning


		on_end_anim="if(cycle < 40, animation('normal'), [die(),fire_event(parent,'fire')])"
			[animation]
			id=normal
			image=enemies/moth-small.png
			rect=151,27,165,41
			pad=3
			frames=4
			duration=1
			[/animation]


		[/object_type]

		[object_type]
		id=shot
		prototype=shot
		[vars]
			team="'evil'"
			damage=1
		[/vars]
		dies_on_inactive=yes
		affected_by_currents=yes
		object_level_collisions=yes

		on_create="add_particles('particles')"
		on_end_anim="animation('normal')"

		timer_frequency=4
		on_timer="set(rotate, cycle*10)"

			[animation]
			id=normal
			image=enemies/moth-small.png
			rect=151,10,161,20
			pad=3
			frames=2
			duration=2
			reverse=yes
			body_area=all
			attack_area=all
			[/animation]

				[particle_system]
				id=particles
				zorder=9
				type=simple
				spawn_rate=500
				time_to_live=40
				min_x=00
				max_x=20
				min_y=00
				max_y=20
				velocity_magnitude=100
				velocity_magnitude_random=100
				velocity_rotate_random=360
					[animation]
					id=sparkle
					image=enemies/moth-small.png
					x=151
					y=2
					w=5
					h=5
					pad=3
					frames=4
					duration=10
					[/animation]
				[/particle_system]

		[/object_type]
	[/object_type]
