[object_type]
	id=civ_board
	hitpoints=2
	z=-10
	no_compile_image="experimental/civ-tile.png"
	
	[editor_info]
		category=crazy-stuff
	[/editor_info]
	
	[properties]
		mouse = "def() level.player.ctrl_mice[0]"
		
		board_size = "def() consts.tile_size*consts.tiles"
		
		on_tile = "def() 
			if(mx > x and mx < x+board_size()*2 and my > y and my < y+board_size()*2,
				[(mx-x)/(consts.tile_size*2), (my-y)/(consts.tile_size*2)])
			where mx = level.player.vars.mouse.pos_x() where my = level.player.vars.mouse.pos_y()"
			
		tile_at = "def (coord) [x+consts.tile_size+x_in*consts.tile_size*2,y+consts.tile_size+y_in*consts.tile_size*2] where x_in = coord[0] where y_in = coord[1]"
		
		dealt_hand_loc = "def (player, spot) if(spot in range(consts.hand_size) and player = 0,
		[x + margin + step * spot, y + board_size()*2 + space_beneath]
		where step = ((board_size() - margin) * 2) / (consts.hand_size - 1)
		where margin = 110
		where space_beneath = 50
		)"
		
		#needs work#
		open_hand = "def (player) if(vars.hand and player = 0, frees where frees = map(range(size(vars.hand)), 'slot', 'Slot ' + str(slot) + ': ' + vars.hand[slot].type), -1)"
	[/properties]
	
	[consts]
		tiles = 14
		tile_size = 17
		
		hand_size = 6

	[/consts]
	
	[vars]
		hand = []
	[/vars]
	
	on_create="[set(draw_area, [0, 0, board_size(), board_size()]),
		
		#
		[set(hand, new_tiles),
		map(new_tiles, 'new_tile', add_object(new_tile)),
		] where new_tiles = map(range(consts.hand_size), 'deal', 
			object('civ-tile_blank', crd[0], crd[1], facing)
			where crd = dealt_hand_loc(0, deal)),
		#
		
		[add_object(new_bag),
		set(vars.bag, new_bag),
		]where new_bag = object('civ-tile_bag', x + board_size()*2 + 100, y+((board_size()*5)/3), facing),
		
		
		]"
		
	on_lmb_hold="[
		#debug('tile:', on_tile())#
		if(ot,
			[set(tmp.old_ot, ot),
			if(tmp.old_ot != ot,
				[set(tmp.tile_highlight, hlt),
				add_object(hlt),
				remove_object(tmp.tile_highlight),
				]where hlt = object('civ_board.tile', tile_at(ot)[0], tile_at(ot)[1], facing)
				)
			],
			[set(tmp.old_ot, 0),
			remove_object(tmp.tile_highlight),
			])
		where ot = on_tile()
		]"
		
	on_lmb_up="[
		remove_object(tmp.tile_highlight),
		]"
	
	#on_process = "[debug(open_hand(0))]"
	
	on_end_anim="animation('normal')"
	
	[animation]
		id=normal
		image=experimental/civ-tile.png
		x=0
		y=0
		w=17
		h=17
		pad=-1
		frames=1
		duration=6541
		surface_area=all
	[/animation]
	
	
	[object_type]
		id=tile
		hitpoints=2
		z=-9
		
		on_create = "[
			set(red, tint), set(green, tint), set(blue, tint),
			] where tint = 200"
		
		[animation]
			id=normal
			image=experimental/civ-tile.png
			x=0
			y=0
			w=17
			h=17
			pad=-1
			frames=1
			duration=6541
			surface_area=all
		[/animation]
	[/object_type]
	
[/object_type]