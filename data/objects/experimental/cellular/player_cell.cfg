[object_type]
  id=player_cell
  feet_width=1
  mass=5
  friction=0
  solid_area=0,0,15,15
  zorder=30
  is_human=yes
  no_move_to_standing=yes

  [editor_info]
    category=cellular
  [/editor_info]

  [properties]
    movement="[if('d' in ctrl_keys,1,0) - if('a' in ctrl_keys,1,0), if('w' in ctrl_keys,1,0) - if('s' in ctrl_keys,1,0)]"
    team="'good'"
  [/properties]
  hitpoints=50
  timer_frequency=3

  [vars]
    speed=1
    default_speed=1
    boost_speed=2

    max_energy=700
    energy=700

    fire_rate=1
    fire_speed=1000
    magnetism=100

    max_hitpoints=50
  [/vars]

  on_load="[
    add_particles('trail'),
  ]"

  on_process="[
    set(velocity_x, (movement[0]*500 - abs(movement[1])*100*movement[0])*vars.speed),
    set(velocity_y, -(movement[1]*500 - abs(movement[0])*100*movement[1])*vars.speed),

    if('left' in ctrl_mice[0],
      if(tmp.lmb = 0, [set(tmp.lmb, 1), fire_event('lmb_down')],
	if(tmp.lmb = 1, fire_event('lmb_hold'))),
      if(tmp.lmb = 1, [set(tmp.lmb, 0), fire_event('lmb_up')])),

    if('right' in ctrl_mice[0],
      if(tmp.rmb = 0, [set(tmp.rmb, 1), fire_event('rmb_down')],
	if(tmp.rmb = 1, fire_event('rmb_hold'))),
      if(tmp.rmb = 1, [set(tmp.rmb, 0), fire_event('rmb_up')])),

    if('q' in ctrl_keys,
      if(tmp.qkey = 0, [set(tmp.qkey, 1), fire_event('q_key_down')],
	if(tmp.qkey = 1, fire_event('q_key_hold'))),
      if(tmp.qkey = 1, [set(tmp.qkey, 0), fire_event('q_key_up')])),

    if('e' in ctrl_keys,
      if(tmp.ekey = 0, [set(tmp.ekey, 1), fire_event('e_key_down')],
	if(tmp.ekey = 1, fire_event('e_key_hold'))),
      if(tmp.ekey = 1, [set(tmp.ekey, 0), fire_event('e_key_up')])),

    if('middle' in ctrl_mice[0],[set(level.time_freeze, level.time_freeze + cycle*10),set(level.chars_immune_from_freeze, me)],set(level.time_freeze,0))
  ]"

  on_lmb_hold="[
    if(cycle - tmp.last_fired > 10/fire_rate,[
      if(vars.energy > 1, [
	spawn('bluebullet',midpoint_x,midpoint_y,0,[
	  set(trackx,ctrl_mice[0][0]*2+level.camera_position[0]),
	  set(tracky,ctrl_mice[0][1]*2+level.camera_position[1]),
	  set(velocity, vars.fire_speed)
	]),
	add(vars.energy,-1),
	set(tmp.last_fired, cycle)
      ])
    ])
  ]"

  on_rmb_hold="[
    if(vars.energy > (vars.max_energy/5),[
      set(vars.speed, vars.boost_speed),
      add(vars.energy, -2)
      ],
      set(vars.speed, vars.default_speed)
    )
  ]"

  on_rmb_up="[
    set(vars.speed, vars.default_speed)
  ]"

  on_q_key_down="[
    if(vars.energy > 100 and hitpoints < vars.max_hitpoints,[
      add(vars.energy,-100),
      add(hitpoints,min(10,vars.max_hitpoints-hitpoints))
    ])
  ]"

  on_e_key_down="[
    if(hitpoints > (vars.max_hitpoints/10) and vars.energy < vars.max_energy,[
      add(hitpoints,-5),
      add(vars.energy,50)
    ])
  ]"

  [base:animation]
    image=experimental/cellular/cell.png
    accel_x=0
    accel_y=0
    pad=0
    body_area=all
  [/animation]
  [animation]
    id=stand_north
    rect=2,2,17,17
    frames=1
    duration=6
  [/animation]
  [particle_system]
    id=trail
    type=point
    generation_rate_millis=1500
    time_to_live=1000
    time_to_live_rand=2000
    colors="00D3FFff,00A2C3ff,00A2C355,00839D55,00799055"
    pos_x=10
    pos_y=10
    velocity_x=0
    velocity_y=0
  [/particle_system]
[/object_type]
